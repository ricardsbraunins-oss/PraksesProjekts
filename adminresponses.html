<!DOCTYPE html>
<html>
<head>
  <title>Admin aptaujas atbildes</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<!-- Parāda lietotājvārdu augšējā labajā stūrī -->
<div id="userDisplay" style="
  position: fixed;
  top: 10px;
  right: 15px;
  font-size: 18px;
  color: black;
"></div>

<script>
  // Pārbauda vai lietotājs ir admin
  const currentUser = localStorage.getItem("username")
  if (currentUser !== "admin") {
    alert("Access denied! Only admin can view this page.")
    window.location.href = "index.html"
  }
</script>

<h2>Visas aptaujas atbildes + admin funkcija</h2>
<p style="color:red;">Tikai administratoram!</p>

<!-- Tabula kurā tiks ielikti visi ieraksti -->
<table border="1" id="responsesTable">
  <tr>
    <th>Vārds</th>
    <th>Mīļākā krāsa</th>
    <th>Vecums</th>
    <th>Ar ko pārvietojas</th>
    <th>Kur mācās/strādā</th>
    <th>Dzīvo dienesta viesnīcā?</th>
    <th>Dzēst</th>
  </tr>
</table>

<!-- Poga atpakaļ -->
<button onclick="window.location.href='index.html'">Atpakaļ sākumā!</button>

<script type="module">
  import { supabase } from './supabase.js'

  // Ielādē visus aptaujas ierakstus
  async function loadResponses() {
    const { data, error } = await supabase
      .from('responses')
      .select('*')

    // Ja Supabase dod kļūdu
    if (error) {
      alert("Error: " + error.message)
      return
    }

    const table = document.getElementById("responsesTable")

    // Katrs ieraksts tiek ielikts tabulā
    data.forEach(row => {
      const newRow = table.insertRow()

      newRow.insertCell(0).innerText = row.q1
      newRow.insertCell(1).innerText = row.q2
      newRow.insertCell(2).innerText = row.q3
      newRow.insertCell(3).innerText = row.q4
      newRow.insertCell(4).innerText = row.q5
      newRow.insertCell(5).innerText = row.q6

      // Dzēšanas poga
      const deleteCell = newRow.insertCell(6)
      const deleteBtn = document.createElement("button")
      deleteBtn.style.width = "80px"
      deleteBtn.style.color = "red"
      deleteBtn.innerText = "X"

      // Dzēš ierakstu no Supabase un tabulas
      deleteBtn.addEventListener("click", async () => {
        if (!confirm("Tiešām dzēst šo ierakstu?")) return

        await supabase
          .from("responses")
          .delete()
          .eq("id", row.id)

        newRow.remove()
      })

      deleteCell.appendChild(deleteBtn)
    })
  }

  // Izsauc datu ielādi
  loadResponses()
</script>

</body>
</html>
